<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: scripts/game.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: scripts/game.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Main game script for El Pollo Loco
 * Contains game initialization, controls, and UI management functions
 * @author El Pollo Loco Team
 * @version 1.0.0
 */

/** @type {HTMLCanvasElement} Main game canvas element */
let canvas;

/** @type {World} Game world instance containing all game objects */
let world;

/** @type {Keyboard} Keyboard input handler instance */
let keyboard = new Keyboard();

/** @type {boolean} Global mute state for all audio */
let isMuted = false;

/**
 * Loads the saved mute status from localStorage
 * Updates the mute icon if status is found
 * @function
 */
function loadMuteStatus() {
  const savedMuteStatus = localStorage.getItem("elPolloLocoMuted");
  if (savedMuteStatus !== null) {
    isMuted = JSON.parse(savedMuteStatus);
    updateMuteIcon();
  }
}

/**
 * Updates the mute icon based on current mute state
 * @function
 */
function updateMuteIcon() {
  const icon = document.getElementById("mute-icon");
  if (icon) {
    icon.src = isMuted ? "./img/logo/mute.png" : "./img/logo/volume.png";
  }
}

/**
 * Initializes the game canvas and world
 * Creates a new World instance with canvas and keyboard
 * @function
 */
function init() {
  canvas = document.getElementById("canvas");
  world = new World(canvas, keyboard);
}

/**
 * Handles keydown events for game controls
 * @param {KeyboardEvent} e - The keyboard event
 * @function
 */
function handleKeyDown(e) {
  if (world?.gameOver || !world?.gameRunning) return;
  setKeyState(e.keyCode, true);
}

/**
 * Sets the state of keyboard keys based on key code
 * @param {number} keyCode - The key code from the keyboard event
 * @param {boolean} state - The state to set (true for pressed, false for released)
 * @function
 */
function setKeyState(keyCode, state) {
  if (keyCode == 39) keyboard.RIGHT = state;
  if (keyCode == 37) keyboard.LEFT = state;
  if (keyCode == 40) keyboard.DOWN = state;
  if (keyCode == 38) keyboard.UP = state;
  if (keyCode == 32) keyboard.SPACE = state;
  if (keyCode == 68) keyboard.D = state;
}

window.addEventListener("keydown", handleKeyDown);

/**
 * Handles keyup events for game controls
 * @param {KeyboardEvent} e - The keyboard event
 * @function
 */
function handleKeyUp(e) {
  if (world?.gameOver || !world?.gameRunning) return;
  setKeyState(e.keyCode, false);
}

window.addEventListener("keyup", handleKeyUp);

/**
 * Stops world-related sound effects (win and game over sounds)
 * @function
 * @private
 */
function stopWorldSounds() {
  if (world.winSfx) {
    world.winSfx.pause();
    world.winSfx.currentTime = 0;
  }
  if (world.gameOverSfx) {
    world.gameOverSfx.pause();
    world.gameOverSfx.currentTime = 0;
  }
}

/**
 * Stops character-related sound effects (walk and snore sounds)
 * @function
 * @private
 */
function stopCharacterSounds() {
  if (world.char) {
    if (world.char.stopWalkSound) world.char.stopWalkSound();
    if (world.char.stopSnoreSound) world.char.stopSnoreSound();
  }
}

/**
 * Stops all audio in the game including background music and sound effects
 * @function
 */
function stopAllSounds() {
  if (world) {
    stopWorldSounds();
    if (world.stopBackgroundMusic) {
      world.stopBackgroundMusic();
    }
    stopCharacterSounds();
    if (world.endboss &amp;&amp; world.endboss.stopEndbossSound) {
      world.endboss.stopEndbossSound();
    }
  }
}

/**
 * Cleans up the current world instance and resets level data
 * @function
 * @private
 */
function cleanupWorld() {
  if (world) {
    if (world.animationFrameId) {
      cancelAnimationFrame(world.animationFrameId);
    }
    world.throwableObjects = [];
    cleanupEnemies();
    world = null;
  }
  if (typeof level1 !== "undefined") {
    level1 = null;
  }
}

/**
 * Cleans up enemy animations and intervals
 * @function
 * @private
 */
function cleanupEnemies() {
  if (world.level &amp;&amp; world.level.enemies) {
    world.level.enemies.forEach((enemy) => {
      if (enemy.animationInterval) clearInterval(enemy.animationInterval);
      if (enemy.stopEndbossSound) enemy.stopEndbossSound();
    });
    world.level.enemies = [];
  }
}

/**
 * Starts background music with a delay
 * @function
 * @private
 */
function startBackgroundMusicDelayed() {
  setTimeout(() => {
    if (world &amp;&amp; world.startBackgroundMusic &amp;&amp; !isMuted) {
      world.startBackgroundMusic();
    }
  }, 100);
}

/**
 * Starts a new game session
 * Cleans up previous game state and initializes new game
 * @function
 */
function startGame() {
  stopAllSounds();
  cleanupWorld();
  setStylesStartGame();
  bttnDisappear();
  initLevel();
  init();
  startBackgroundMusicDelayed();
}

/**
 * Sets UI styles when starting the game
 * Shows game canvas and hides menu screens
 * @function
 * @private
 */
function setStylesStartGame() {
  document.getElementById("start-screen").style.display = "none";
  document.getElementById("game-over").style.display = "none";
  document.getElementById("canvas").style.display = "block";
  document.getElementById("game-won").style.display = "none";
  document.getElementById("mute-button").style.display = "block";
  const touchControls = document.getElementById("touch-controls");
  if (touchControls &amp;&amp; window.innerWidth &lt;= 720) {
    touchControls.style.display = "block";
  }
}

/**
 * Sets visibility of control information based on screen size
 * @function
 * @private
 */
function setControlsVisibility() {
  if (window.innerWidth >= 1024) {
    document.getElementById("start-screen").style.display = "flex";
    document.getElementById("controls-info").style.display = "block";
  } else if (window.innerWidth &lt; 1024) {
    document.getElementById("controls-info").style.display = "none";
  }
}

function hideGameScreens() {
  document.getElementById("game-over").style.display = "none";
  document.getElementById("canvas").style.display = "none";
  document.getElementById("game-won").style.display = "none";
  document.getElementById("mute-button").style.display = "block";
}

function hideTouchControls() {
  const touchControls = document.getElementById("touch-infos");
  if (touchControls) {
    touchControls.style.display = "none";
  }
}

function setStylesStartScreen() {
  setControlsVisibility();
  hideGameScreens();
  updateMuteIcon();
  hideTouchControls();
}

function showStartScreen() {
  stopAllSounds();
  if (world &amp;&amp; world.stopGame) {
    world.stopGame();
  }
  setStylesStartScreen();
  bttnDisappear();
}

function bttnDisappear() {
  console.log("buttons verschwinden");

  document.getElementById("restart-button").style.display = "none";
  document.getElementById("menu-button").style.display = "none";
}

function checkOrientation() {
  const overlay = document.getElementById("rotate-screen");
  if (window.innerHeight > window.innerWidth) {
    overlay.style.display = "flex";
  } else {
    overlay.style.display = "none";
  }
}
window.addEventListener("resize", checkOrientation);
window.addEventListener("orientationchange", function () {
  setTimeout(checkOrientation, 100);
});

function handleMuteOn(icon) {
  icon.src = "./img/logo/mute.png";
  stopAllSounds();
  if (world &amp;&amp; world.char) {
    world.char.stopWalkSound();
    if (world.char.stopSnoreSound) world.char.stopSnoreSound();
  }
}

function handleMuteOff(icon) {
  icon.src = "./img/logo/volume.png";
  if (world &amp;&amp; !world.gameOver &amp;&amp; !world.gameWon &amp;&amp; world.gameRunning) {
    if (world.endboss &amp;&amp; world.bossBehaviorStarted) {
      world.endboss.endbossSfx.currentTime = 0;
      world.endboss.endbossSfx.play().catch((e) => console.log("Endboss audio failed:", e));
    } else {
      world.startBackgroundMusic();
    }
  }
}

function toggleMute() {
  const icon = document.getElementById("mute-icon");
  isMuted = !isMuted;
  localStorage.setItem("elPolloLocoMuted", JSON.stringify(isMuted));

  if (isMuted) {
    handleMuteOn(icon);
  } else {
    handleMuteOff(icon);
  }
}

function toggleCopyright() {
  const overlay = document.getElementById("copyright-overlay");

  if (overlay.style.display === "none" || overlay.style.display === "") {
    overlay.style.display = "flex";
  } else {
    overlay.style.display = "none";
  }
}

function toggleControls() {
  const panel = document.getElementById("controls-panel");
  const button = document.getElementById("controls-toggle");

  if (panel.style.display === "none" || panel.style.display === "") {
    panel.style.display = "block";
    button.textContent = "üéÆ Steuerung verbergen";
  } else {
    panel.style.display = "none";
    button.textContent = "üéÆ Steuerung anzeigen";
  }
}

function getTouchElements() {
  return {
    touchLeft: document.getElementById("touch-left"),
    touchRight: document.getElementById("touch-right"),
    touchThrow: document.getElementById("touch-throw"),
    touchAttack: document.getElementById("touch-attack"),
  };
}

function addTouchStartEvents(elements) {
  elements.touchLeft.addEventListener("touchstart", (e) => {
    e.preventDefault();
    keyboard.LEFT = true;
  });
  elements.touchRight.addEventListener("touchstart", (e) => {
    e.preventDefault();
    keyboard.RIGHT = true;
  });
  elements.touchThrow.addEventListener("touchstart", (e) => {
    e.preventDefault();
    keyboard.D = true;
  });
  elements.touchAttack.addEventListener("touchstart", (e) => {
    e.preventDefault();
    keyboard.SPACE = true;
  });
}

function addTouchEndEvents(elements) {
  elements.touchLeft.addEventListener("touchend", (e) => {
    e.preventDefault();
    keyboard.LEFT = false;
  });
  elements.touchRight.addEventListener("touchend", (e) => {
    e.preventDefault();
    keyboard.RIGHT = false;
  });
  elements.touchThrow.addEventListener("touchend", (e) => {
    e.preventDefault();
    keyboard.D = false;
  });
  elements.touchAttack.addEventListener("touchend", (e) => {
    e.preventDefault();
    keyboard.SPACE = false;
  });
}

function addTouchCancelEvents(elements) {
  [elements.touchLeft, elements.touchRight, elements.touchThrow, elements.touchAttack].forEach((button) => {
    button.addEventListener("touchcancel", (e) => {
      e.preventDefault();
      keyboard.LEFT = false;
      keyboard.RIGHT = false;
      keyboard.D = false;
      keyboard.SPACE = false;
    });
  });
}

function initTouchControls() {
  const elements = getTouchElements();
  addTouchStartEvents(elements);
  addTouchEndEvents(elements);
  addTouchCancelEvents(elements);
}
document.addEventListener("DOMContentLoaded", function () {
  initTouchControls();
  loadMuteStatus();
});

function showGameOver() {
  document.getElementById("game-over").style.display = "block";
  document.getElementById("game-over-screen").style.display = "flex";
  const touchControls = document.getElementById("touch-controls");
  if (touchControls) {
    touchControls.style.display = "none";
  }
}

function showGameWon() {
  document.getElementById("game-won").style.display = "block";
  document.getElementById("game-won-screen").style.display = "flex";
  const touchControls = document.getElementById("touch-controls");
  if (touchControls) {
    touchControls.style.display = "none";
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Char.html">Char</a></li><li><a href="DrawableObject.html">DrawableObject</a></li><li><a href="Endboss.html">Endboss</a></li><li><a href="Keyboard.html">Keyboard</a></li><li><a href="Level.html">Level</a></li><li><a href="MoveableObject.html">MoveableObject</a></li><li><a href="ThrowableObject.html">ThrowableObject</a></li><li><a href="World.html">World</a></li></ul><h3>Global</h3><ul><li><a href="global.html#canvas">canvas</a></li><li><a href="global.html#handleKeyDown">handleKeyDown</a></li><li><a href="global.html#handleKeyUp">handleKeyUp</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#isMuted">isMuted</a></li><li><a href="global.html#keyboard">keyboard</a></li><li><a href="global.html#loadMuteStatus">loadMuteStatus</a></li><li><a href="global.html#setKeyState">setKeyState</a></li><li><a href="global.html#startGame">startGame</a></li><li><a href="global.html#stopAllSounds">stopAllSounds</a></li><li><a href="global.html#updateMuteIcon">updateMuteIcon</a></li><li><a href="global.html#world">world</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sat Jul 19 2025 19:24:51 GMT+0200 (Mitteleurop√§ische Sommerzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
